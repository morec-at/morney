{
  "id": "snapshot_1765724430978_07jj75lr1",
  "approvalId": "approval_1765724430959_14utrqujq",
  "approvalTitle": "Requirements approval: double-entry household bookkeeping (kakeibo)",
  "version": 1,
  "timestamp": "2025-12-14T15:00:30.978Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements Document\n\n## Introduction\n\n本仕様は、家計簿を「複式簿記（仕訳・勘定科目・総勘定元帳）」として記録し、日々の支出管理だけでなく、月次の収支（損益）と資産負債（貸借）を一貫して把握できるようにするための機能要件を定義する。\n\n主な価値:\n- 入力が会計的に整合し、集計のブレ（カテゴリの二重計上等）が起きにくい\n- いつ・何に使ったか（支出）と、いま何を持っているか（資産）を同じデータから説明できる\n- 銀行/カード明細取り込みと照合により入力負担を下げる\n\n## Alignment with Product Vision\n\n`morney` の「An accounting book」という方向性に沿い、個人/家庭向けの最小構成の会計帳簿（家計簿）として、以下を実現する:\n- 複式簿記の基本帳簿（仕訳帳/元帳）を中心に据える\n- 家計管理に必要なレポート（収支・資産推移）を提供する\n\n※ 現時点で `.spec-workflow/steering/product.md` が未整備のため、本セクションは将来の steering 追加時に再調整する。\n\n## Requirements\n\n### Requirement 1: 勘定科目（科目体系）の管理\n\n**User Story:** 家計の記録者として、勘定科目（資産/負債/純資産/収益/費用）を管理したい。そうすれば、仕訳入力とレポートが一貫した体系で整理できる。\n\n#### Acceptance Criteria\n\n1. WHEN 初回に帳簿を作成する THEN システム SHALL 家計向けのデフォルト勘定科目セット（例: 現金、普通預金、クレジットカード、食費、家賃、給与 等）を作成する\n2. WHEN ユーザーが勘定科目を追加/編集/無効化する THEN システム SHALL 科目名・種別（資産/負債/純資産/収益/費用）を保持する\n3. IF 既に仕訳で使用されている勘定科目を削除しようとする THEN システム SHALL 削除を拒否し、代替として無効化（非表示化）を案内する\n\n### Requirement 2: 仕訳（ジャーナルエントリ）の作成・編集\n\n**User Story:** 家計の記録者として、複式簿記の仕訳を入力したい。そうすれば、支出・収入・振替を同じ形式で正しく記録できる。\n\n#### Acceptance Criteria\n\n1. WHEN ユーザーが仕訳を保存する THEN システム SHALL 借方合計と貸方合計が一致することを検証する\n2. WHEN ユーザーが仕訳を保存する THEN システム SHALL 仕訳に日付・摘要（メモ）・明細行（借方/貸方の複数行）を保持する\n3. IF 借方合計と貸方合計が一致しない THEN システム SHALL 保存を拒否し、差額を表示する\n\n### Requirement 3: 家計向け簡易入力（ワンクリック仕訳）\n\n**User Story:** 家計の記録者として、日々の支出/収入を簡単なフォームで入力したい。そうすれば、複式簿記の知識が浅くても継続して記帳できる。\n\n#### Acceptance Criteria\n\n1. WHEN ユーザーが「支出」を入力する THEN システム SHALL 「費用（選択カテゴリ）」を借方、「支払元（現金/預金/カード等）」を貸方とする仕訳を生成する\n2. WHEN ユーザーが「収入」を入力する THEN システム SHALL 「入金先（資産）」を借方、「収益（選択カテゴリ）」を貸方とする仕訳を生成する\n3. WHEN ユーザーが支払元を「クレジットカード」にした THEN システム SHALL 貸方に「クレジットカード（負債）」を使用する\n\n### Requirement 4: 振替（資産間移動・負債返済等）の記録\n\n**User Story:** 家計の記録者として、口座間振替やカード引き落とし等を記録したい。そうすれば、資産・負債の残高が実態と一致する。\n\n#### Acceptance Criteria\n\n1. WHEN ユーザーが口座間の振替を入力する THEN システム SHALL 「入金先（資産）」を借方、「出金元（資産）」を貸方とする仕訳を生成する\n2. WHEN ユーザーがカード引き落とし（返済）を入力する THEN システム SHALL 「クレジットカード（負債）」を借方、「支払口座（資産）」を貸方とする仕訳を生成する\n\n### Requirement 5: 分割（1取引の複数費目）入力\n\n**User Story:** 家計の記録者として、1回の支払いを複数の費目に分割して記録したい。そうすれば、家計の内訳を正確に把握できる。\n\n#### Acceptance Criteria\n\n1. WHEN ユーザーが1つの支払いに複数の費用明細を追加する THEN システム SHALL 複数の借方明細（費用科目）と単一または複数の貸方明細を許可する\n2. IF 分割後の借方合計と貸方合計が一致しない THEN システム SHALL 保存を拒否する\n\n### Requirement 6: 帳簿（ブック）と期間の切り替え\n\n**User Story:** 家計の記録者として、家庭ごと/用途ごとに帳簿を分けたい。そうすれば、集計や共有の範囲を適切に管理できる。\n\n#### Acceptance Criteria\n\n1. WHEN ユーザーが新しい帳簿を作成する THEN システム SHALL 帳簿ごとに勘定科目・仕訳・設定を独立して保持する\n2. WHEN ユーザーが期間（例: 今月/今年/任意範囲）を指定する THEN システム SHALL 指定範囲の仕訳に基づいて一覧・レポートを表示する\n\n### Requirement 7: レポート（残高・収支・推移）の表示\n\n**User Story:** 家計の管理者として、資産残高や月次の収支を見たい。そうすれば、家計の状態を定量的に判断できる。\n\n#### Acceptance Criteria\n\n1. WHEN ユーザーが残高一覧を開く THEN システム SHALL 資産・負債・純資産の勘定残高を表示する\n2. WHEN ユーザーが収支レポートを開く THEN システム SHALL 指定期間の収益・費用の集計（損益）を表示する\n3. WHEN ユーザーが元帳/仕訳帳を開く THEN システム SHALL 勘定別・日付順に取引履歴を表示する\n\n### Requirement 8: インポート（明細取り込み）と未確定取引の扱い\n\n**User Story:** 家計の記録者として、銀行/カード明細を取り込みたい。そうすれば、手入力の手間を減らし、漏れを防げる。\n\n#### Acceptance Criteria\n\n1. WHEN ユーザーがCSVを取り込む THEN システム SHALL 日付・金額・摘要等の明細行を読み込み、未確定取引として保存できる\n2. WHEN ユーザーが未確定取引を「確定（仕訳化）」する THEN システム SHALL 対応する仕訳を生成し、以後レポートに反映する\n3. IF 同一明細（例: 日付・金額・識別子）が既に取り込まれている THEN システム SHALL 重複取り込みを検知し、ユーザーに選択肢（スキップ/上書き）を提示する\n\n### Requirement 9: エクスポートとバックアップ\n\n**User Story:** 家計の記録者として、データをエクスポート/バックアップしたい。そうすれば、移行や障害時の復旧ができる。\n\n#### Acceptance Criteria\n\n1. WHEN ユーザーがエクスポートを実行する THEN システム SHALL 仕訳・勘定科目・設定を機械可読形式（例: CSV/JSON）で出力できる\n2. WHEN 自動バックアップが有効 THEN システム SHALL 指定間隔または起動/終了時にバックアップを作成する\n\n## Non-Functional Requirements\n\n### Code Architecture and Modularity\n- **Single Responsibility Principle**: 仕訳、科目、インポート、レポート等を責務ごとに分離する\n- **Modular Design**: UI/ドメイン/永続化/集計ロジックを分割し、置換可能な設計にする\n- **Dependency Management**: 集計ロジックはUIに依存せず、永続化も抽象化する\n- **Clear Interfaces**: 取引（仕訳）・科目・帳簿に対する明確なAPI/インターフェースを定義する\n\n### Performance\n- WHEN 仕訳件数が 50,000 件規模になっても THEN 主要画面（一覧・レポート）の初期表示 SHALL 実用的な時間（目標: 数秒以内）で完了する\n\n### Security\n- IF ローカル端末で利用する THEN データはユーザーのファイル権限により保護されること\n- WHEN バックアップ/エクスポートを行う THEN 個人情報が含まれる可能性を明示し、保存先をユーザーが選べること\n\n### Reliability\n- WHEN アプリが異常終了しても THEN 直近の保存済みデータは破損しない（トランザクション整合性）こと\n- WHEN バックアップから復元する THEN システム SHALL 主要データ（科目・仕訳）が復元できること\n\n### Usability\n- WHEN 家計簿用途で入力する THEN 仕訳の専門知識がなくても最小ステップで「支出/収入/振替」を登録できること\n- IF 入力内容が不整合（借貸不一致など） THEN ユーザーが修正できるよう、エラー理由と修正箇所を明確に示すこと\n",
  "fileStats": {
    "size": 9141,
    "lines": 130,
    "lastModified": "2025-12-14T15:00:22.897Z"
  },
  "comments": []
}