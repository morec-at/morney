{
  "id": "snapshot_1765724974899_d153y6poe",
  "approvalId": "approval_1765724974891_edeg3qgbi",
  "approvalTitle": "Tasks approval: double-entry household bookkeeping (kakeibo)",
  "version": 1,
  "timestamp": "2025-12-14T15:09:34.899Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document\n\n- [ ] 1. Project scaffolding (Python + SQLite)\n  - Files: `pyproject.toml` (or `requirements.txt`), `src/morney/`, `README.md` updates\n  - Define minimal packaging, entrypoint, and local dev commands\n  - Decide storage location for the SQLite DB file (per book or per workspace)\n  - _Requirements: 6, 9_\n  - _Prompt: Role: Python developer | Task: Create minimal project scaffolding for a local-first double-entry household ledger with a SQLite-backed store and a CLI entrypoint | Restrictions: Prefer stdlib-only; keep structure modular (domain/services/storage/ui) | Success: App runs locally, imports work, storage path is configurable_\n\n- [ ] 2. Define domain models and invariants\n  - File: `src/morney/domain/models.py` (or equivalent)\n  - Model: Book, Account, JournalEntry, Posting, ImportedTransaction\n  - Implement validations: debit/credit totals must match; amounts are non-negative integers; required IDs/date fields\n  - _Requirements: 1, 2, 5, 8_\n  - _Prompt: Role: Domain engineer | Task: Implement the core domain models and validation invariants for double-entry bookkeeping | Restrictions: No DB code in domain; validations must be reusable by services and CLI | Success: Invalid entries are rejected with clear errors; models cover all required fields_\n\n- [ ] 3. Design and implement SQLite schema + migrations\n  - Files: `src/morney/storage/schema.sql`, `src/morney/storage/migrate.py`\n  - Tables: books, accounts, journal_entries, postings, imported_transactions (+ indexes)\n  - Constraints: FK integrity; unique dedup key; account active flag; posting amounts positive\n  - _Requirements: 1, 2, 6, 8_\n  - _Prompt: Role: Storage engineer | Task: Create an initial SQLite schema and migration runner for the ledger | Restrictions: Use SQLite features (FKs, indexes); keep schema evolution via migrations | Success: DB initializes cleanly and enforces core constraints_\n\n- [ ] 4. Implement repository layer (LedgerRepository)\n  - Files: `src/morney/storage/repository.py`\n  - CRUD for: books, accounts, journal entries (create/list/update), imported transactions\n  - Filtering: date range, accountId, status\n  - _Requirements: 1, 2, 6, 8_\n  - _Prompt: Role: Backend developer | Task: Implement repository methods for storing and retrieving ledger data using SQLite | Restrictions: Keep SQL isolated; transactions for multi-row writes (entry+postings) | Success: Repository supports all use-cases and preserves data integrity_\n\n- [ ] 5. Account management use-cases (defaults + lifecycle)\n  - Files: `src/morney/services/accounts.py`\n  - Create default chart of accounts on new book\n  - Add/edit/disable accounts; prevent deletion when referenced\n  - _Requirements: 1, 6_\n  - _Prompt: Role: Product-minded backend dev | Task: Implement account management workflows including default accounts and safe disabling | Restrictions: No hard-deletes for used accounts | Success: New books get defaults; used accounts cannot be deleted; inactive accounts are hidden by default_\n\n- [ ] 6. Journal entry service (create/update + validation)\n  - Files: `src/morney/services/journal.py`\n  - Create entry with postings; validate debit/credit equality\n  - Update policy: allow editing memo/date/postings (initially), maintain updatedAt\n  - _Requirements: 2, 5_\n  - _Prompt: Role: Backend developer | Task: Implement journal entry creation/editing service with strict double-entry validation | Restrictions: All writes in a single transaction; return actionable validation errors | Success: Mismatched totals are rejected; saved entries can be listed and viewed_\n\n- [ ] 7. Quick entry helpers (expense / income / transfer / card payment)\n  - Files: `src/morney/services/quick_entry.py`\n  - Generate correct postings for:\n    - Expense: debit expense, credit payment source (cash/bank/card liability)\n    - Income: debit asset, credit revenue\n    - Transfer: debit to-asset, credit from-asset\n    - Card payment: debit card liability, credit bank asset\n  - Support split expenses (multiple expense debits)\n  - _Requirements: 3, 4, 5_\n  - _Prompt: Role: Backend developer | Task: Implement quick-entry functions that map household workflows into valid journal entries (including split lines) | Restrictions: Must reuse journal service validations; keep UI-independent | Success: Generated postings match requirements and always balance_\n\n- [ ] 8. Reporting: balances, P&L, ledger views\n  - Files: `src/morney/services/reports.py`\n  - Balance summary (assets/liabilities/equity) as-of date\n  - Income statement (revenue/expenses) for date range\n  - Ledger view per account (running balance)\n  - _Requirements: 7_\n  - _Prompt: Role: Data/finance engineer | Task: Implement report calculations derived solely from postings | Restrictions: Keep calculations deterministic and testable; avoid float math | Success: Reports match expected totals and reconcile with postings_\n\n- [ ] 9. CSV import pipeline + pending transactions\n  - Files: `src/morney/services/imports.py`, `src/morney/importers/csv_generic.py`\n  - Import CSV into `ImportedTransaction` with configurable column mapping\n  - Dedup strategy using `dedupKey` (external id or stable hash)\n  - Pending list; ignore; link/confirm into journal entry\n  - _Requirements: 8_\n  - _Prompt: Role: Backend developer | Task: Implement CSV import, dedup, and a pendingâ†’confirmed workflow that creates linked journal entries | Restrictions: Imported rows must not affect reports until confirmed; confirm creates balanced entries | Success: Duplicate detection works; pending items can be confirmed/ignored; confirmed items link to entries_\n\n- [ ] 10. Export + backup/restore\n  - Files: `src/morney/services/export.py`, `src/morney/services/backup.py`\n  - Export to JSON/CSV (accounts, entries, postings, imports)\n  - Backup: copy SQLite file or export bundle; restore into new DB\n  - _Requirements: 9_\n  - _Prompt: Role: Backend developer | Task: Implement export and backup/restore for safe data portability | Restrictions: Must preserve IDs and relationships; avoid partial exports | Success: Export is complete; restore recreates identical ledger state_\n\n- [ ] 11. CLI UI for core flows\n  - Files: `src/morney/ui/cli.py` (argparse), `src/morney/__main__.py`\n  - Commands:\n    - book: create/list/select\n    - accounts: list/add/edit/disable\n    - entry: create (raw), list, show\n    - quick: expense/income/transfer/card-payment (with split)\n    - reports: balances, pnl, ledger\n    - import: csv, pending, confirm, ignore\n    - export/backup/restore\n  - _Requirements: 1, 2, 3, 4, 6, 7, 8, 9_\n  - _Prompt: Role: CLI developer | Task: Build a usable CLI that exposes the primary bookkeeping workflows end-to-end | Restrictions: Keep commands consistent; helpful errors; no external UI deps required | Success: A user can complete the main flows using only the CLI_\n\n- [ ] 12. Automated tests (stdlib unittest)\n  - Files: `tests/test_domain.py`, `tests/test_journal.py`, `tests/test_quick_entry.py`, `tests/test_reports.py`, `tests/test_imports.py`\n  - Focus on invariants and report correctness:\n    - balancing validation and split expenses\n    - card purchase + payment flows\n    - report totals and running balances\n    - dedup behavior and confirm/ignore behavior\n  - _Requirements: All_\n  - _Prompt: Role: QA engineer | Task: Add fast, deterministic unit/integration tests for the ledger domain/services using SQLite temp DBs | Restrictions: Avoid network and flaky time dependencies | Success: Tests cover critical flows and pass consistently_\n\n- [ ] 13. Documentation and examples\n  - Files: `README.md`, `docs/examples.md`\n  - Provide: setup, data location, example commands, CSV import mapping examples, common troubleshooting\n  - _Requirements: 7, 8, 9_\n  - _Prompt: Role: Technical writer | Task: Document how to use the CLI for real household bookkeeping workflows with examples | Restrictions: Keep docs concise and accurate; include example CSV schemas | Success: A new user can install, record transactions, view reports, and back up data_\n",
  "fileStats": {
    "size": 8021,
    "lines": 107,
    "lastModified": "2025-12-14T15:09:26.942Z"
  },
  "comments": []
}